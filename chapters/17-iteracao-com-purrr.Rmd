# Iteração com `purrr`

## Introdução

Não temos exercícios para esta seção.

## Loops `for`

### Exercício 17.2.1 {- #exr17-2-1}

::: {.enunciado}
Escreva loops for para:

a. Calcular a média de cada coluna em `mtcars`.
b. Determinar o tipo de cada colunas em `nycflights13::flights`.
c. Calcular o número de valores únicos em cada coluna de `iris`.
d. Gerar 10 valores aleatórias normalmente distribuídos para cada `$mu$ = -10, 0, 10, 100`.

Pense sobre saída, seuência e corpo *antes* de começar a escrever o loop.
:::

::: {.solution}
a. Para calcular a média de cada uma das colunas de `mtcars`, podemos utilizar o seguinte *loop*:
```{r}
output <- vector("double", ncol(mtcars))
for(i in seq_along(mtcars)) {
  output[[i]] <- mean(mtcars[[i]])
}

output
```


b. Para determinar o tipo de cada uma das colunas de `nycflights13::flights`, podemos usar o seguinte:

```{r}
output <- vector("character", ncol(flights))
for (i in seq_along(flights)) {
  output[[i]] <- typeof(flights[[i]])
}

output
```
c. Para calcular o número de valores únicos em cada coluna do dataset `iris`, podemos usar o seguinte:

```{r}
output <- vector("integer", ncol(iris))
for (i in seq_along(iris)) {
  output[[i]] <- iris[[1]] %>% 
                    unique() %>% 
                    length()
}
output
```
d. Para gerar 10 distribuições normais aleatórias para cara um dos valores citados de `$mu$`, podemos usar o seguinte:

```{r}
n <- 10
mu <- c(-10, 0, 10, 100)
normals <- vector("list", length(mu))
for (i in seq_along(normals)) {
  normals[[i]] <- rnorm(n, mean = mu[[i]])
}
str(normals)
```
:::

### Exercício 17.2.2 {- #exr17-2-2}

::: {.enunciado}
Elimine o loop for em cada um dos exemplos a seguir aproveitando umafunção existente que dê certo com vetores.

```
out <- ""
for(x in letters) {
  out <- stringr::str_c(out, x)
}

x <- sample(100)
sd <- 0
for (i in seq_along(x)) {
  sd <- sd + (x[i] - mean(x)) ^ 2
}
sd <- sqrt(sd / (length(x) - 1))

x <- runif(100)
out <- vector("numeric", length(x))
out[1] <- x[1]
for (i in 2:length(x)) {
  out[i] <- out[i - 1] + x[i]
}
```
:::

::: {.solution}
O primeiro loop apenas concatena os valores do vetor, e poderia ser substituído por:

```{r}
stringr::str_c(letters, collapse = "")
```

O segundo loop realiza o cálculo do desvio padrão e poderia ser substituído por:

```{r}
x <- sample(100)
sd <- sd(x)
sd
```
O último loop calcula a soma cumulativa de um vetor e poderia ser substituído por:

```{r}
x <- runif(100)
out <- cumsum(x)
out
```
:::

### Exercício 17.2.3 {- #exr17-2-3}

::: {.enunciado}
Combine suas habilidades de escrita de funções e loops for:

a. Escreva um loop for que imprima (`print()`) a letra da música infantil "Alice the Camel".
b. Converta a cantiga infantil "Ten in the Bed" em uma função. Generalize-a para qualquer número de pessoas em qualquer estrutura de dormir.
:::

::: {.solution}
a.

```{r}
humps <- 5
for (i in seq(humps, 0, -1)) {
  cat(
    str_c("Alice the camel has ", rep(i, 3), " humps", collapse = "\n"), 
    collapse = "\n"
  )
  
  if(i == 0) {
    cat("Now Alice is a horse.\n")
  } else {
    cat("So go, Alice, go. Boom, boom, boom!\n\n")
  }
}
```
b. 

```{r}
n_in_the_bed <- function(n = 10, structure = "bed") {
  cat("LYRICS FOR ", n, " IN THE ", str_to_upper(structure), "\n\n")
  
  for (i in n:2) {
    cat("There were ", i, " in the ", structure, "\n")
    cat("And the little one said \"Roll over, roll over\"\n")
    cat("So they all rolled over and one fell out \n\n")
  }

  cat("There was ", i - 1, " in the bad\n")
  cat("And the little one said, \"Goodnight\" \n\n")
}

n_in_the_bed()
n_in_the_bed(5, "rede")
```
:::

### Exercício 17.2.4 {- #exr17-2-4}

::: {.enunciado}
x
:::

::: {.solution}
x
:::

## Variações do loop `for`

## Loops `for` _versus_ funcionais

## As funções `map`

## Lidando com falhas

## Fazendo `map` com vários argumentos

## Walk

## Outros padrões para loops `for`